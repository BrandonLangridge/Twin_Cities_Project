<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>POI Details</title>
  <link rel="stylesheet" href="styles.css">
</head>

<body>
  <div class="container" role="main">
    <div class="header">
      <a href="javascript:history.back()" aria-label="Go back to map">‚Üê Back</a>
      <button id="accessibility-toggle" aria-pressed="false" aria-label="Toggle colour blind mode">
        Colour Blind Mode
      </button>
    </div>
    <div id="output" aria-live="polite"></div>
  </div>

  <script>
    // Retrieves the user's previously chosen accessibility settings.
    let voiceEnabled = localStorage.getItem("voiceEnabled") === "true";
    let colorBlindEnabled = localStorage.getItem("colorBlindEnabled") === "true";

    // Immediate check to apply the colorblind CSS class if needed
    if (colorBlindEnabled) { document.body.classList.add("colorblind"); }

    /* TEXT-TO-SPEECH ENGINE
       Standardised function to provide audio feedback across the web application.
    */
    function speak(text) {
      if (!voiceEnabled || !window.speechSynthesis) return;
      window.speechSynthesis.cancel();
      const msg = new SpeechSynthesisUtterance(text);
      window.speechSynthesis.speak(msg);
    }

    /* ACCESSIBILITY TOGGLE LOGIC
       Updates both the visual state and the saved preference in the browser.
    */
    const toggleBtn = document.getElementById("accessibility-toggle");
    toggleBtn.setAttribute("aria-pressed", colorBlindEnabled);

    toggleBtn.addEventListener("click", () => {
      const enabled = document.body.classList.toggle("colorblind");
      localStorage.setItem("colorBlindEnabled", enabled);
      toggleBtn.setAttribute("aria-pressed", enabled);
      speak(enabled ? "Colour blind mode enabled" : "Colour blind mode disabled");
    });

    /* URL PARAMETER PARSING
       This grabs the POI name from the URL
    */
    const params = new URLSearchParams(window.location.search);
    const poiName = params.get("poi");
    const output = document.getElementById("output");

    // If no POI is in the URL, show an error.
    if (!poiName) {
      output.innerHTML = "<div class='error'>No POI specified.</div>";
    } else {
      loadPOI(poiName);
    }

    /* 5. ASYNCHRONOUS DATA FETCHING (Wikipedia API)
       This is the core logic that retrieves live data from an external source.
    */
    async function loadPOI(name) {
      try {
        // Fetching a summary from Wikipedia's REST API using the POI name
        const response = await fetch(`https://en.wikipedia.org/api/rest_v1/page/summary/${encodeURIComponent(name)}`);
        const data = await response.json();
        
        // If the Wikipedia page doesn't exist or API fails, trigger the catch block
        if (!response.ok || !data.title) throw new Error();

        // Building the HTML structure dynamically using template literals (``)
        output.innerHTML = `
          <div class="content">
            <div class="image">
              ${data.thumbnail ? `<img src="${data.thumbnail.source}" alt="${data.title}">` : ""}
            </div>
            <div class="details">
              <h1>${data.title}</h1>
              <p>${data.extract}</p>
              <div class="source">Source: <a href="${data.content_urls.desktop.page}" target="_blank">Wikipedia</a></div>
            </div>
          </div>
        `;
        // Audio confirmation that the page has loaded
        speak(`Showing details for ${data.title}`);
        
      } catch {
        // Error handling: if the fetch fails, notify the user visually and audibly
        output.innerHTML = "<div class='error'>Unable to load POI.</div>";
        speak("Unable to load details.");
      }
    }
  </script>
</body>
</html>






  

